stage ('pi_%VERSION%') {
  agent{
    label "%CITA_VERSION%&&pi&&%VERSION%"
  }
  steps {                
    script {
      def rc = 0
      def citaDEVT="/devt/"
      echo "NODE_NAME = ${env.NODE_NAME}"            
      def path = "/opt/mdyalog/%VERSION%/32/unicode/mapl"
      def exists = fileExists(path)          
      if (exists) {
        echo "PLATFORM=pi, path=${path}: File exists!"
      } else {
        error "Found no interpreter for ${env.NODE_NAME}. Labels: ${env.NODE_LABELS}"
      }
      def cmdline = '%CMDLINE%'
      cmdline = "${cmdline} citaDEVT=${citaDEVT}"
      echo "Launching $path $cmdline "
      sh(script: "$path $cmdline" , returnStatus: true)
      exists = fileExists("%CITA_LOG%.ok") 
      if (exists) {
        echo "Test succeeded"
        rc = 0
      } else {
        echo "Test did not end with status file %CITA_LOG%.ok"
        rc = 1
      }
      echo "rc=${rc}"
      if (rc==0) {
        sh "exit 0"
      } else {
        sh "exit 1"
      }
    }
  }
}
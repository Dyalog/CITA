stage ("mac&&%CITA_VERSION%&&%VERSION%") {
  node ("mac&&%CITA_VERSION%&&%VERSION%") {
    // no looping over bits/editions - mac is always unicode 64 
    catchError(buildResult: "UNSTABLE", stageResult: "FAILURE") {
      echo "NODE_NAME = ${env.NODE_NAME}"            
      path = "/Dyalog/Dyalog-%VERSION%.app/Contents/Resources/Dyalog/mapl"
      exists = fileExists(path)      
      if (exists) {
        echo "PLATFORM=mac, path=${path}: File exists!"
      } else {
        echo "PLATFORM=mac, path=${path}: File does not exist, trying another path"
        path = "/Applications/Dyalog-%VERSION%.app/Contents/Resources/Dyalog/mapl"
        exists = fileExists(path)          
        if (exists) {
          echo "PLATFORM=mac, path=${path}: File exists!"
        } else {
          error "PLATFORM=mac, path=${path}: File does not exist, giving it up!"
        }
      }
      testPath="%xinO%mac_%VERSION%_u64/"
      CITAlog="${testPath}CITA.log"
      echo "CITAlog=$CITAlog"
      cmdline = "%CMDLINE% USERCONFIGFILE=${testPath}cita.dcfg CITA_Log=${CITAlog} LOG_FILE=${testPath}CITA_Session.dlf"
      echo "cmdline=$cmdline"
      if ("${env.NODE_NAME}"=="mac3") {
        echo "replacing for mac3"
        cmdline = cmdline.replaceAll("/devt/","/Volumes/devt/")
        CITAlog = CITAlog.replaceAll("/devt/","/Volumes/devt/")
        testPath = testPath.replaceAll("/devt/","/Volumes/devt/")
        echo "cmdLine=$cmdline"
        citaDEVT="/Volumes/devt/"
        echo "citaDEVT=$citaDEVT"
      } else {
        citaDEVT="/devt/"
      }
      cmdline = "${cmdline} citaDEVT=${citaDEVT}"
      echo "Launching $path $cmdline"
      //sh "$path $cmdline"
      rjc = sh(script: "$path $cmdline" , returnStatus: true)
      echo "CITAlog=$CITAlog|${CITAlog}"
      sh "ls ${testPath}"
      exists = fileExists("${CITAlog}.ok") 
      if (exists) {
        echo "Test succeeded"
        sh "exit 0"
      } else {
        echo "Test did not end with status file ${CITAlog}.ok"
        sh "exit 1"
      }
    }
  }
}